<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>IMGUI 中文支持方案 | シャロン</title>
<meta property="og:title" content="IMGUI 中文支持方案 | シャロン"><meta property="og:description" content="没学过 c++，单纯想头铁汉化个东西，就查资料折腾了一下，这里做一个小的总结。如果有更好的方案请指正。"><meta property="og:url" content="https://sheronw.xyz/posts/2020-07-01-imgui-chinese/"><meta property="og:image" content="https://sheronw.xyz/avatar.png"><link rel=stylesheet href=/css/main.min.aefd766b49c87cf40aaa69142f6e0ec3bb1bc609c0fcd074fa6c7b87eca729b1.css integrity="sha256-rv12a0nIfPQKqmkUL24Ow7sbxgnA/NB0+mx7h+ynKbE=" crossorigin=anonymous><script src=/js/main.23cd0c7d837263b9eaeb96ee2d9ccfa2969daa3fa00fa1c1fe8701a9b87251a1.js integrity="sha256-I80MfYNyY7nq65buLZzPopadqj+gD6HB/ocBqbhyUaE=" crossorigin=anonymous></script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@200..900&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400..800;1,400..800&family=Noto+Serif+SC:wght@200..900&display=swap" rel=stylesheet></head><body><div class=wrap><div class=flex><header><a href=/><img src=/avatar.png></a>
<class id=header-inner class=page-header-inner><h1 id=site-title>シャロン</h1><nav><ul><li><img src=/nav.gif>
<a href=/>主页</a>
<img src=/nav.gif></li><li><img src=/nav.gif>
<a aria-current=true class=ancestor href=/posts/>文章</a>
<img src=/nav.gif></li><li><img src=/nav.gif>
<a href=/tags/>标签</a>
<img src=/nav.gif></li><li><img src=/nav.gif>
<a href=/aboutme/>关于</a>
<img src=/nav.gif></li></ul></nav></class></header><div class=right><main><h1>IMGUI 中文支持方案</h1><p>Time published:
<time datetime=2020-07-01T00:00:00+00:00>July 1, 2020</time></p><p>没学过 c++，单纯想头铁汉化个东西，就查资料折腾了一下，这里做一个小的总结。如果有更好的方案请指正。</p><h2 id=加载字体>加载字体</h2><p>首先需要加载支持中文的字体。
网上最多的解决方案是读取外部的<code>.ttf/.otf</code>字体，亲测可用。但需要用户的目录读取权限，而且可能出现字体不存在的情况。</p><p>对于源码内嵌字体，IMGUI 的作者其实也给出了一个解决方案：<a href=https://github.com/ocornut/imgui/blob/0738611559b0a51c7fa0c376eb9601587231f841/misc/fonts/binary_to_compressed_c.cpp>将 binary 转换为 C array 的工具</a>。如果软件只是使用拉丁字集的话，文件不大应该也没什么问题，我打算汉化的软件本身用的也是这个解决方案，但将中文字集转换为 C Array 的话大小至少是西文字集的几千倍吧。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>ImGuiIO<span style=color:#f92672>&amp;</span> io <span style=color:#f92672>=</span> ImGui<span style=color:#f92672>::</span>GetIO();
</span></span><span style=display:flex><span>IMFont<span style=color:#f92672>*</span> ttf_font <span style=color:#f92672>=</span> io.Fonts<span style=color:#f92672>-&gt;</span>AddFontFromFileTTF(<span style=color:#e6db74>&#34;res/simhei.ttf&#34;</span>, <span style=color:#ae81ff>16.0f</span>, Null, io.Fonts<span style=color:#f92672>-&gt;</span>GetGlyphRangesChinese());
</span></span><span style=display:flex><span>IMFont<span style=color:#f92672>*</span> compressed_font <span style=color:#f92672>=</span> io.Fonts<span style=color:#f92672>-&gt;</span>AddFontFromMemoryCompressedTTF(SimHei_compressed_data,SimHei_compressed_size, <span style=color:#ae81ff>16.f</span>, Null, io.Fonts<span style=color:#f92672>-&gt;</span>GetGlyphRangesChinese());
</span></span></code></pre></div><p>这里解释一下，<code>GetGlyphRangesChinese()</code> 用来指定加载字符集，我需要改动的软件基于 IMGUI 1.4，所以只有这个方法，在更新的版本中，这个被加载常用汉字的<code>GetGlyphRangesChineseSimplifiedCommon()</code>和加载所有汉字的<code>GetGlyphRangesChineseFull()</code>所取代。</p><h2 id=汉字编码>汉字编码</h2><p>如果是 c++11，直接给中文字符串添加<code>u8</code>前缀就可以了，源代码本身应该也是<code>UTF-8</code>。之前的版本可以上网找个转换函数复制下来用。</p><h2 id=调整-oversampling-配置>调整 OverSampling 配置</h2><p>参考 <a href=https://github.com/ocornut/imgui/issues/1434#issuecomment-344205472>Github 上的这个 Issue</a>。之前提到过中文字集特别占内存，而 IMGUI 的字体基于 FontAlas，至少在我这个版本（1.4）中不能动态加载，所以可能编译跑起来之后发现满屏黑白方块。</p><p>在作者提供的解决办法中，其中看起来最简单粗暴的方法是减少 OverSampling。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>ImFontConfig config_words;
</span></span><span style=display:flex><span>config_words.OversampleV <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>config_words.OversampleH <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>; <span style=color:#75715e>// 默认为3
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>font_14 <span style=color:#f92672>=</span> io.Fonts<span style=color:#f92672>-&gt;</span>AddFontFromMemoryCompressedTTF(SimHei_compressed_data,SimHei_compressed_size, <span style=color:#ae81ff>16.f</span>, <span style=color:#f92672>&amp;</span>config_words, io.Fonts<span style=color:#f92672>-&gt;</span>GetGlyphRangesChinese());
</span></span></code></pre></div><p>除此之外还可以请求 Alpha Texture （超出我能力范围了 QvQ）或者手动缩小<code>glyphRange</code>，只保留自己用到的字符。</p><div class=article-label><div>Tags:</div><ul><li><a href=/tags/%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/>折腾记录</a></li></ul></div></main></div></div><footer><p><a href=#>Back to Top</a><br>Powered by <a href=https://gohugo.io/>Hugo</a>. Copyright 2025.
All rights reserved.</p><img src=/footer.png></footer></div></body></html>