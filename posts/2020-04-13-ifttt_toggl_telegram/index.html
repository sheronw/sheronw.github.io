<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>利用 IFTTT 将 Toggl Report 发送到 Telegram Channel | シャロン</title>
<meta property="og:title" content="利用 IFTTT 将 Toggl Report 发送到 Telegram Channel | シャロン"><meta property="og:description" content="【2020.11.5 更新】趣闻一则：因为 star 了 Toggl API，被一个英国的独立开发者发了 cold email，于是就花了十分钟在 zoom 上和他聊了聊，老哥似乎是想做一个使用类似 Toggl 这样的工具收集数据，然后用机器学习分析码农生产力的产品。"><meta property="og:url" content="https://sheronw.xyz/posts/2020-04-13-ifttt_toggl_telegram/"><meta property="og:image" content="https://sheronw.xyz/avatar.png"><link rel=stylesheet href=/css/main.min.f0c8ce02ddbec47f4d94fb71d63457fbc8b472346ef24fcd73ee6375779fb4b6.css integrity="sha256-8MjOAt2+xH9NlPtx1jRX+8i0cjRu8k/Nc+5jdXeftLY=" crossorigin=anonymous><script src=/js/main.23cd0c7d837263b9eaeb96ee2d9ccfa2969daa3fa00fa1c1fe8701a9b87251a1.js integrity="sha256-I80MfYNyY7nq65buLZzPopadqj+gD6HB/ocBqbhyUaE=" crossorigin=anonymous></script></head><body><div class=wrap><div class=flex><header><a href=/><img src=/avatar.png></a>
<class id=header-inner><h1 id=site-title>シャロン</h1><nav><ul><li><img src=/nav.gif>
<a href=/>主页</a></li><li><img src=/nav.gif>
<a aria-current=true class=ancestor href=/posts/>文章</a></li><li><img src=/nav.gif>
<a href=/tags/>标签</a></li><li><img src=/nav.gif>
<a href=/aboutme/>关于</a></li></ul></nav></class></header><div class=right><main><h1>利用 IFTTT 将 Toggl Report 发送到 Telegram Channel</h1><p>Time published:
<time datetime=2020-04-13T00:00:00+00:00>April 13, 2020</time></p><p>【2020.11.5 更新】趣闻一则：因为 star 了 Toggl API，被一个英国的独立开发者发了 cold email，于是就花了十分钟在 zoom 上和他聊了聊，老哥似乎是想做一个使用类似 Toggl 这样的工具收集数据，然后用机器学习分析码农生产力的产品。</p><p>【2020.9.25 更新】现在 IFTTT 开始付费，感觉不值，散了吧散了吧（虽然 Toggl Report 的获取依然可以参考）。</p><h2 id=主要思路>主要思路</h2><p>生写一个 Telegram Bot 也不是不行但我就是想找借口玩 IFTTT</p><p>VPS 或树莓派：写一个自动化的程序并定时运行，从 Toggl Report API 获取数据，整理之后 Post 给 IFTTT 的 Webhook。</p><p>IFTTT：<code>if</code> 收到服务器端的 Post <code>then</code> 发消息到 Telegram 指定 chat</p><p>Telegram：利用<a href=https://t.me/IFTTT>@IFTTT</a>实现 IFTTT 与 Telegram 的联动</p><p>本记录使用的是目前的 Toggl API v8 以及 Toggl Report API v2。</p><h2 id=获取-toggl-api-token-及-workspace-id>获取 Toggl API Token 及 Workspace ID</h2><p>登录 Toggl 网页版，进入<code>Profile Settings</code>页面翻到下面有自己的<code>api_token</code>，把这玩意儿记下来待会儿用。切换到自己想要获取 Report 的 Workspace，点 Settings，把地址栏中<code>https://toggl.com/app/{workspace_id}/settings/general</code>的<code>workspace_id</code>记下来。</p><p>还有另外一种更加麻烦的获取方式：</p><p>在命令行中输入（第一行替换自己的<code>api_token</code>）：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -v -u <span style=color:#f92672>{</span>api_token<span style=color:#f92672>}</span>:api_token <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -X GET <span style=color:#e6db74>&#39;https://www.toggl.com/api/v8/workspaces&#39;</span>
</span></span></code></pre></div><p>然后在返回的一大堆 JSON 数据中中找到相应 Workspace 名字并记录其<code>id</code>。</p><h2 id=创建-ifttt-recipe>创建 IFTTT Recipe</h2><p>在 Telegram 中找到 <a href=https://t.me/IFTTT>@IFTTT</a> 的官方机器人，<code>\start</code>并授权 IFTTT 帐号，根据机器人提示关联相应的群组或频道。（如果是私密频道的话要先公开把机器人拉进来再改回去……）</p><p>在 IFTTT 中新建一个 Recipe：</p><ul><li><code>this</code> 选择 Webhook -> Receive a web request，设置 event 名</li><li><code>that</code> 选择 Telegram -> Send message -> 信息内容只留 value1</li></ul><h2 id=编码及部署>编码及部署</h2><p>IFTTT 还是不太行，对于高贵的 Apple 用户来说，整个流程都能用 workflow 来无代码无服务器实现。</p><p>咱用了 Node.js 在 Linode 上跑。</p><h3 id=获取-toggl-数据>获取 Toggl 数据</h3><p>以每周发送本周的 Detailed Report 为例，想要在这个基础上实现其他功能可以参考其<a href=https://github.com/toggl/toggl_api_docs/blob/master/reports.md#request-parameters>官方文档</a>。</p><p>常用参数：</p><ul><li><code>user_agent</code>：必填，app 名或自己邮箱就行</li><li><code>workspace_id</code>：必填，即上一步我们记录的 id</li><li><code>since</code>和<code>until</code>：YYYY-MM-DD 格式，默认区间为[today-6 days,today]</li></ul><p>先<code>node 文件名.js</code> 在命令行里打印下原始数据，确认代码可用。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>https</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;https&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>api_token</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;你的api_token&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>workplace_id</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;你的workplace_id&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>user_agent</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;你的邮箱或应用名&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>url</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>URL</span>(
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;https://toggl.com/reports/api/v2/details?user_agent=&#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>user_agent</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&amp;workspace_id=&#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>workplace_id</span>
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>options</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Content-Type&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;application/json&#34;</span>,
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>auth</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>api_token</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;:api_token&#34;</span>,
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>https</span>.<span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>url</span>, <span style=color:#a6e22e>options</span>, (<span style=color:#a6e22e>res</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#34;data&#34;</span>, (<span style=color:#a6e22e>chunk</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>data</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>chunk</span>;
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#34;end&#34;</span>, () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 获得所有数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>data</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><h3 id=清理格式>清理格式</h3><p>IFTTT 果然不太行，只能 POST 三个值，那就头铁把结果并成一个字符串吧。</p><p>先把能用得到的数据挑出来，然后整理格式。</p><p>把上面代码里的 <code>console.log(data);</code>替换成下面的内容，再打印看效果……</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>minEntries</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>data</span>).<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>reduce</span>((<span style=color:#a6e22e>acc</span>, <span style=color:#a6e22e>cur</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 选取需要的信息
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>description</span>, <span style=color:#a6e22e>start</span>, <span style=color:#a6e22e>end</span>, <span style=color:#a6e22e>project</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>cur</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>summary</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>start</span>.<span style=color:#a6e22e>slice</span>(<span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>10</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74> </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>start</span>.<span style=color:#a6e22e>slice</span>(<span style=color:#ae81ff>11</span>, <span style=color:#ae81ff>16</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>-</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>end</span>.<span style=color:#a6e22e>slice</span>(
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>11</span>,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>16</span>
</span></span><span style=display:flex><span>  )<span style=color:#e6db74>}</span><span style=color:#e6db74>「</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>project</span><span style=color:#e6db74>}</span><span style=color:#e6db74>」</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>description</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&lt;br&gt;`</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>acc</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>summary</span>;
</span></span><span style=display:flex><span>}, <span style=color:#e6db74>&#34;&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>minEntries</span>);
</span></span></code></pre></div><h3 id=发送至-ifttt>发送至 IFTTT</h3><p>进入 <a href=https://ifttt.com/maker_webhooks>https://ifttt.com/maker_webhooks</a>，选择右上角 <code>Documentation</code>，记录发送请求的 URL。</p><p>然后把之前新建的 Receipe 的 Event 名添加到你的 URL 那个空缺里，用它来发送一个 POST 请求。</p><p>把我们上一步处理完的字符串作为数据 POST 出去，然后整个编码过程就完工了（</p><p>再次运行，测试自己的频道或群聊是否收到相应消息。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>https</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;https&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>api_token</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;你的 API Token&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>workplace_id</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;你的 Workplace ID&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>user_agent</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;你的邮箱或应用名&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>webhook</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`https://maker.ifttt.com/trigger/你的Event名/with/key/你url的key`</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>url</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>URL</span>(
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;https://toggl.com/reports/api/v2/details?user_agent=&#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>user_agent</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&amp;workspace_id=&#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>workplace_id</span>
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>options</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Content-Type&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;application/json&#34;</span>,
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>auth</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>api_token</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;:api_token&#34;</span>,
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>https</span>.<span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>url</span>, <span style=color:#a6e22e>options</span>, (<span style=color:#a6e22e>res</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#34;data&#34;</span>, (<span style=color:#a6e22e>chunk</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>data</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>chunk</span>;
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#34;end&#34;</span>, () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>minEntries</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>data</span>).<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>reduce</span>((<span style=color:#a6e22e>acc</span>, <span style=color:#a6e22e>cur</span>) =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#75715e>// 选取需要的信息
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>description</span>, <span style=color:#a6e22e>start</span>, <span style=color:#a6e22e>end</span>, <span style=color:#a6e22e>project</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>cur</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>summary</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>start</span>.<span style=color:#a6e22e>slice</span>(<span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>10</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74> </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>start</span>.<span style=color:#a6e22e>slice</span>(<span style=color:#ae81ff>11</span>, <span style=color:#ae81ff>16</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>-</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>end</span>.<span style=color:#a6e22e>slice</span>(
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>11</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>16</span>
</span></span><span style=display:flex><span>      )<span style=color:#e6db74>}</span><span style=color:#e6db74>「</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>project</span><span style=color:#e6db74>}</span><span style=color:#e6db74>」</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>description</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&lt;br&gt;`</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>acc</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>summary</span>;
</span></span><span style=display:flex><span>    }, <span style=color:#e6db74>&#34;&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sendToIFTTT</span>(<span style=color:#a6e22e>minEntries</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>sendToIFTTT</span>(<span style=color:#a6e22e>data</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>postData</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>value1</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>data</span>,
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>options</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;POST&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;Content-Type&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;application/json&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;Content-Length&#34;</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Buffer</span>.<span style=color:#a6e22e>byteLength</span>(<span style=color:#a6e22e>postData</span>),
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>req</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>https</span>.<span style=color:#a6e22e>request</span>(<span style=color:#a6e22e>webhook</span>, <span style=color:#a6e22e>options</span>, (<span style=color:#a6e22e>res</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`STATUS: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>statusCode</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#34;error&#34;</span>, (<span style=color:#a6e22e>e</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>`problem with request: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>message</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Write data to request body
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>write</span>(<span style=color:#a6e22e>postData</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>end</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=定时运行>定时运行</h3><p>利用 Crontab 实现每周日晚上 23:59 运行该程序，请使用命令<code>date</code>查看 VPS 所在地区的时间。</p><p>命令行中输入<code>crontab -e</code>，然后添加一行：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#ae81ff>59</span> <span style=color:#ae81ff>23</span> * * <span style=color:#ae81ff>0</span> node /home/你的用户名/到程序的路径
</span></span></code></pre></div><h2 id=其他想法>其他想法</h2><p>这么一套搞下来，觉得用 IFTTT 的自动化还是挺鸡肋的，工作量近似于自己搞一个 Telegram Bot ，POST 还有参数限制。</p><p>不过动手搞的过程中想到了很多脑洞：</p><ul><li><em>因为 Toggl API 还可以输出 PDF 格式的 Report，所以可以用类似的原理来自动化储存 Report 至云端（IFTTT）？</em></li><li>可以用 IFTTT 实现 Google Assistant 和之前写的 Expire Soon Bot 的联动</li><li>IFTTT 只适合轻量级的自动化，比如 Spotify 收藏新歌或者 Github 开新坑之后分享到频道这样的。但从另一个角度来说，其简单易用性能让非程序员也能玩得开心，相比之下 Workflow 虽然功能强大，但对于不熟悉程序的人来说上手成本太高了（</li></ul><div class=article-label><div>Tags:</div><ul><li><a href=/tags/%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/>折腾记录</a></li></ul></div></main></div></div><footer><p><a href=#>Back to Top</a><br>Powered by <a href=https://gohugo.io/>Hugo</a>. Copyright 2023.
All rights reserved.</p><img src=/footer.png></footer></div></body></html>